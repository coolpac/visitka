#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤ (cache busting)

VERSION=$(date +%s)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º timestamp –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
# –ò–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: VERSION=$(git rev-parse --short HEAD 2>/dev/null || date +%s)

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤: v=$VERSION"

# –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏–∏ –≤ index.html
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    sed -i '' "s/\?v=[0-9.]*/\?v=$VERSION/g" index.html
else
    # Linux
    sed -i "s/\?v=[0-9.]*/\?v=$VERSION/g" index.html
fi

echo "‚úÖ –í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ: v=$VERSION"
echo "üìù –§–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫–µ—à–∞"

